<div class="border rounded-lg p-4 bg-white shadow-md max-w-2xl mx-auto my-10">
  <h2 class="text-xl font-semibold mb-4">üí¨ Join the Discussion</h2>
  <div id="chat-box" class="h-64 overflow-y-scroll bg-gray-100 p-3 mb-2 rounded"></div>
  <input id="chat-input" type="text" placeholder="Type a message..." class="w-full border px-4 py-2 rounded mb-2" />
  <button id="chat-send-btn" class="bg-sky-600 text-white px-4 py-2 rounded">Send</button>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const slug = "{{ blog.slug|escapejs }}";

    if (!slug) {
      console.error("‚ùå blog.slug is not defined ‚Äî check if context has 'blog'");
      return;
    }

    const chatSocket = new WebSocket("ws://" + window.location.host + "/ws/blogchat/" + slug + "/");

    chatSocket.onmessage = function (e) {
      const data = JSON.parse(e.data);
      const chatBox = document.querySelector("#chat-box");
      chatBox.innerHTML += `<p><strong>${data.user}</strong>: ${data.message}</p>`;
      chatBox.scrollTop = chatBox.scrollHeight;
    };

    document.querySelector("#chat-send-btn").addEventListener("click", function () {
      const input = document.querySelector("#chat-input");
      const message = input.value.trim();
      if (message.length === 0) return;

      if (chatSocket.readyState === WebSocket.OPEN) {
        chatSocket.send(JSON.stringify({ message: message }));
        input.value = "";
      } else {
        alert("WebSocket not connected.");
      }
    });
  });
</script>
